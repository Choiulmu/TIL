# 20240106 TIL

## ****ë” ìë°”, ì• í”Œë¦¬ì¼€ì´ì…˜ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë‹¤ì–‘í•œ ë°©ë²•****

### íƒœê¹…ê³¼ í•„í„°ë§

- í…ŒìŠ¤íŠ¸ ê·¸ë£¹ ë§Œë“¤ê³  ì›í•˜ëŠ” í…ŒìŠ¤íŠ¸ ê·¸ë£¹ë§Œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥
- í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸ ë©”ì†Œë“œì— ì—¬ëŸ¬ íƒœê·¸ ì‚¬ìš© ê°€ëŠ¥

```java
@DisplayName("ìŠ¤í„°ë”” ê°ì²´ í…ŒìŠ¤íŠ¸")
class StudyTest {

    @Test
    @DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸° fast")
    @Tag("fast")
    @EnabledIfEnvironmentVariable(named = "TEST_ENV", matches = "LOCAL")
    void create_new_study(){
        Study actual = new Study(100);
        assertThat(actual.getLimit()).isGreaterThan(0);
    }

    @Test
    @DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸° slow")
    @Tag("slow")
    void create_new_study_again(){
        System.out.println("create1");
    }

}
```

1) Intellijì—ì„œ íŠ¹ì • íƒœê·¸ë¡œ í…ŒìŠ¤íŠ¸ í•„í„°ë§

<img width="1105" alt="á„á…¦á„‰á…³á„á…³á„‘á…µá†¯á„á…¥á„…á…µá†¼1" src="https://github.com/Choiulmu/TIL/assets/124655364/465b4589-7afc-442c-812c-bbc27a313e39">
<img width="1035" alt="á„á…¦á„‰á…³á„á…³á„‘á…µá†¯á„á…¥á„…á…µá†¼2" src="https://github.com/Choiulmu/TIL/assets/124655364/2e6f8dff-6432-4af6-bce3-866af9abc18d">

2) ë¡œì»¬ í…ŒìŠ¤íŠ¸(í„°ë¯¸ë„)ì—ì„œ íŠ¹ì • íƒœê·¸ë¡œ í…ŒìŠ¤íŠ¸ í•„í„°ë§

- pom.xmlì— ì„¤ì • ì¶”ê°€

```java
<profiles>
        <profile>
            <id>default</id>
            <activation>
                <activeByDefault>true</activeByDefault>
            </activation>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <groups>fast</groups>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>

        <profile>
            <id>ci</id>
            <build>
                <plugins>
                    <plugin>
                        <artifactId>maven-surefire-plugin</artifactId>
                        <configuration>
                            <groups>fast | slow</groups>
                        </configuration>
                    </plugin>
                </plugins>
            </build>
        </profile>
    </profiles>
```

- ./mvnw test: default ì‹¤í–‰
- ./mvnw test -P ci: ci ì‹¤í–‰

### ì»¤ìŠ¤í…€ íƒœê·¸

- Test > .. > New - Java Class - annotation > FastTest/SlowTest ìƒì„±

```java
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
@Test
@Tag("fast")
public @interface FastTest {
}
```

```java
@Target(ElementType.METHOD) //ë©”ì„œë“œ ë ˆë²¨ì—ì„œ ì“¸ ìˆ˜ ìˆì–´
@Retention(RetentionPolicy.RUNTIME) // ì‚¬ìš©í•œ ì½”ë“œê°€ ì´ ì–´ë…¸í…Œì´ì…˜ ì •ë³´ë¥¼ ëŸ°íƒ€ì„ê¹Œì§€ ìœ ì§€í•´ì•¼í•œë‹¤
@Test
@Tag("slow")
public @interface SlowTest {
}
```

- @Target(ElementType.*METHOD*): ì´ ì–´ë…¸í…Œì´ì…˜ì€ ë©”ì„œë“œ ë ˆë²¨ì—ì„œ ì“¸ ìˆ˜ ìˆì–´
- @Retention(RetentionPolicy.*RUNTIME*): ì‚¬ìš©í•œ ì½”ë“œê°€ ì´ ì–´ë…¸í…Œì´ì…˜ ì •ë³´ë¥¼ ëŸ°íƒ€ì„ê¹Œì§€ ìœ ì§€í•´ì•¼í•´
- ìœ„ ì»¤ìŠ¤í…€ íƒœê·¸ ì‚¬ìš©ì‹œ  `@Tag("fast")`  `@Tag("slow")`  í•„ìš”ì—†ì–´ìš©~

### í…ŒìŠ¤íŠ¸ ë°˜ë³µí•˜ê¸°(1) - @RepeatedTest

```java
@DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸°")
@RepeatedTest(value = 10 ,name = "{displayName}, {currentRepetition}/{totalRepetitions}")
void repeatTest(RepetitionInfo repetitionInfo){
    System.out.println("test" + repetitionInfo.getCurrentRepetition() + "/" + repetitionInfo.getTotalRepetitions());
}
```



<img width="607" alt="á„á…¦á„‰á…³á„á…³á„‡á…¡á†«á„‡á…©á†¨á„’á…¡á„€á…µ" src="https://github.com/Choiulmu/TIL/assets/124655364/b93e1ebd-21bf-4145-ac70-b2d10095ca79">

- @RepeatedTest: ë°˜ë³µ íšŸìˆ˜ì™€ ë°˜ë³µ í…ŒìŠ¤íŠ¸ ì´ë¦„ì„ ì„¤ì •
    - {displayName}
    - {currentRepetition}
    - {totalRepetitions}
- RepetitionInfo íƒ€ì…ì˜ ì¸ìë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤.

### í…ŒìŠ¤íŠ¸ ë°˜ë³µí•˜ê¸°(2) - @ParameterizedTest

```java
@DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸°")
@ParameterizedTest(name = "{index} {displayName} message={0}")
@ValueSource(strings = {"ë‚ ì”¨ê°€", "ë§ì´", "ì¶”ì›Œì§€ê³ ", "ìˆë„¤ìš”."})
void parameterizedTest(String message){
    System.out.println(message);
}
```

<img width="897" alt="á„á…¦á„‰á…³á„á…³á„‡á…¡á†«á„‡á…©á†¨á„’á…¡á„€á…µ2" src="https://github.com/Choiulmu/TIL/assets/124655364/feb94017-63c4-4f37-9d67-1a1b9b81b043">

- Junit 5ì—ì„œëŠ” ê¸°ë³¸ ì œê³µ, Junit4ì—ì„œëŠ” ì¨ë“œíŒŒí‹° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ
- @ParameterizedTest: í…ŒìŠ¤íŠ¸ì— ì—¬ëŸ¬ ë‹¤ë¥¸ ë§¤ê°œë³€ìˆ˜ë¥¼ ëŒ€ì…í•´ê°€ë©° ë°˜ë³µ ì‹¤í–‰í•œë‹¤.
    - {displayName}
    - {index}
    - {arguments}
    - {0}, {1}, ...
- ë‹¨ì¼ source/valueë§Œ argumentë¡œ ì „ë‹¬
- @ValueSource / @EnumSource / @MethodSource
- @NullSource, @EmptySource, @NullAndEmptySource : Null/Emptyë¥¼ ì¸ìë¡œ ë„˜ê²¨ì¤Œ

### í…ŒìŠ¤íŠ¸ ë°˜ë³µí•˜ê¸°(3) - ì¸ìê°’ íƒ€ì… ë³€í™˜

```java
@DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸°")
    @ParameterizedTest(name = "{index} {displayName} message={0}")
    @ValueSource(ints = {10, 20, 40})
    void parameterizedTest(@ConvertWith(StudyConvert.class) Study study){
        System.out.println(study.getLimit());
    }

    static class StudyConvert extends SimpleArgumentConverter{

        @Override
        protected Object convert(Object o, Class<?> targetType) throws ArgumentConversionException {
            assertEquals(Study.class, targetType, "Can only convert to Study");
            return new Study(Integer.parseInt(o.toString()));
        }
    }
```

- ì•”ë¬µì ì¸ íƒ€ì… ë³€í™˜: [ë ˆí¼ëŸ°ìŠ¤](https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests-argument-conversion-implicit) ì°¸ê³ 
- ëª…ì‹œì ì¸ íƒ€ì… ë³€í™˜
    - SimpleArgumentConverter ìƒì† ë°›ì€ êµ¬í˜„ì²´ ì œê³µ
    - @ConvertWith
- @ValueSource() - SimpleArgumentConverterì¸í„°í˜ì´ìŠ¤  + @ConvertWith()

```java
@DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸°")
    @ParameterizedTest(name = "{index} {displayName} message={0}")
    @CsvSource({"1, 'ìµœìœ ë¦¼'", "2, 'ì˜¤ì˜ë¹ˆ'", "3, 'ê¹€ì„¸ë¹ˆ'"})
    void parameterizedTest(Integer limit, String name){
        System.out.println(new Study(limit, name));
    }

//ë‹¹ì—°íˆ Study í´ë˜ìŠ¤ì— limitê³¼ name, ì´ ë‘˜ì´ argumentì¸ ìƒì„±ì í•„ìš”
```

- ë³µìˆ˜ì˜ source/valueë¥¼ argumentë¡œ ì „ë‹¬í•´ì¤„ ë•Œ
    - @CsvSource / @CvsFileSource / @ArgumentSource

```java
@DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸°")
    @ParameterizedTest(name = "{index} {displayName} message={0}")
    @CsvSource({"1, 'ìµœìœ ë¦¼'", "2, 'ì˜¤ì˜ë¹ˆ'"})
    void parameterizedTest(ArgumentsAccessor argumentsAccessor){
        Study study = new Study(argumentsAccessor.getInteger(0), argumentsAccessor.getString(1));
        System.out.println(study);
    }
```

- ì¸ì ê°’ ì¡°í•©í•˜ê¸° ArgumentsAccessor
    
    ex) {"1, 'ìµœìœ ë¦¼'", "2, 'ì˜¤ì˜ë¹ˆ'"} â†’ argumentsAccessor
    
- new Study(argumentsAccessor.getInteger(0), argumentsAccessor.getString(1));
    - argumentsAccessor.getInteger(0) â†’ 1
    - argumentsAccessor.getString(1) â†’ ìµœìœ ë¦¼

```java
@DisplayName("ìŠ¤í„°ë”” ë§Œë“¤ê¸°")
    @ParameterizedTest(name = "{index} {displayName} message={0}")
    @CsvSource({"1, 'ìµœìœ ë¦¼'", "2, 'ì˜¤ì˜ë¹ˆ'"})
    void parameterizedTest(@AggregateWith(StudyAggregator.class) Study study){
        System.out.println(study);
    }

    static class StudyAggregator implements ArgumentsAggregator {
        @Override
        public Object aggregateArguments(ArgumentsAccessor argumentsAccessor, ParameterContext parameterContext) throws ArgumentsAggregationException {
            return new Study(argumentsAccessor.getInteger(0), argumentsAccessor.getString(1));
        }
    }
```

- @CsvSource - ArgumentsAggregator ì¸í„°í˜ì´ìŠ¤ + @AggregateWith()
- aggregatorì— ëŒ€í•œ ì œì•½ì¡°ê±´: ë°˜ë“œì‹œ static inner(ë‹¤ë¥¸ í´ë˜ìŠ¤ ì•ˆì— ë“¤ì–´ìˆëŠ” static) / public class
- ê·¸ì™¸ í…ŒìŠ¤íŠ¸ ë°˜ë³µí•˜ê¸° ì°¸ê³  ìë£Œ
: [https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests](https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests)

### JUnit 5 í…ŒìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤

- í…ŒìŠ¤íŠ¸ ê°„ ì˜ì¡´ì„± ì—…ì–´ì•¼ í•¨(B. í…ŒìŠ¤íŠ¸ ìˆœì„œ ì˜ˆì¸¡ ë¶ˆê°€)
- í…ŒìŠ¤íŠ¸ ë©”ì„œë“œì— ëŒ€í•œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§¤ë²ˆ ìƒˆë¡œ ë§Œë“¬(ê¸°ë³¸ ì „ëµ) â†’ Junit 5ë¶€í„° í´ë˜ìŠ¤ë‹¹ í•˜ë‚˜ë¡œ ìˆ˜ì • ê°€ëŠ¥
    - ì„±ëŠ¥ ì¡°ê¸ˆ ë” ì¢‹ì•„
    - @TestInstance(TestInstance.Lifecylcle.PER_CLASS)
    - @BeforeAllê³¼ @AfterAllì´ static ë©”ì„œë“œì¼ í•„ìš”X
    
    <aside>
    â˜ğŸ» WHY?
    
    **`@BeforeAll`**ê³¼ **`@AfterAll`**ì€ ê°ê° ë§¨ ì²˜ìŒ / ë§¨ ë í•œë²ˆë§Œ í˜¸ì¶œë˜ëŠ”ê²Œ ë³´ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
    
    ê¸°ë³¸ì ìœ¼ë¡œ JUnitì€ ê° í…ŒìŠ¤íŠ¸ ë©”ì„œë“œë§ˆë‹¤ ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. **`@BeforeAll`**ê³¼ **`@AfterAll`**ì´ static ë©”ì„œë“œë¡œ ì„ ì–¸ë˜ì–´ì•¼, ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ì™€ ê´€ê³„ì—†ì´ í˜¸ì¶œë  ìˆ˜ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ë”°ë¼ì„œ ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ ë‹¨ í•œ ë²ˆë§Œ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë³´ì¥í•©ë‹ˆë‹¤.
    
    ë°˜ë©´ì— **`@TestInstance(TestInstance.Lifecycle.PER_CLASS)`**ë¥¼ ì‚¬ìš©í•˜ë©´ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë‹¹ í•˜ë‚˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ê²Œ ë©ë‹ˆë‹¤. ì´ ê²½ìš°, ì¸ìŠ¤í„´ìŠ¤ ê°„ì— ìƒíƒœë¥¼ ê³µìœ í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¼ë°˜(non-static) ë©”ì„œë“œë¡œ ì„ ì–¸í•˜ì—¬ë„ ê° ì¸ìŠ¤í„´ìŠ¤ì— ëŒ€í•´ í•œ ë²ˆë§Œ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë³´ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    
    </aside>
    
- êµ¬í˜„
    
    
    ```java
    @TestInstance(TestInstance.Lifecycle.PER_CLASS)
    @DisplayName("ìŠ¤í„°ë”” ê°ì²´ í…ŒìŠ¤íŠ¸")
    class StudyTest {
    ...
    }
    ```
    
<img width="214" alt="á„á…¦á„‰á…³á„á…³á„‹á…µá†«á„‰á…³á„á…¥á†«á„‰á…³" src="https://github.com/Choiulmu/TIL/assets/124655364/c2eb5da4-759a-4eaa-b33f-0f55843c98b8">
    

### JUnit5 í…ŒìŠ¤íŠ¸ ìˆœì„œ

- ì¢‹ì€ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ëŠ” ì„œë¡œ ê°„ì˜ ì˜ì¡´ì„±ì´ ì—†ì–´ì•¼ í•œë‹¤.
- But USE ì¼€ì´ìŠ¤ ê¸°ë°˜ìœ¼ë¡œ ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ ë•Œ â†’ ì„œë¡œ ìƒíƒœë¥¼ ê³µìœ í•˜ë©´ì„œ ìˆœì„œê°€ ì •í•´ì§„ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ë§Œë“¤ì–´ì•¼ í•´.
- @TestMethodOrder(MethodOrderer.OrderAnnotation.class)
- ê¼­ @TestInstance(TestInstance.Lifecycle.PER_CLASS)ë‘ ê°™ì´ ì“¸ í•„ìš” ì—†ìŒ
- êµ¬í˜„ ì˜ˆì‹œ

```java
@TestInstance(TestInstance.Lifecycle.PER_CLASS)
@TestMethodOrder(MethodOrderer.OrderAnnotation.class)
@DisplayName("ìŠ¤í„°ë”” ê°ì²´ í…ŒìŠ¤íŠ¸")
class StudyTest {
...

@Order(1)
void create(){}

@Order(2)
void find(){}
...
}
```

- @Order - Junitê»„ë¡œ importí•´ì•¼í•´(â­ï¸)
- MethodOrderer êµ¬í˜„ì²´: Alphanumeric / OrderAnnoation / Random (ì¶”í›„ ë” ê³µë¶€ ìš”ë§)

### JUnit5:Â **junit-platform.properties**

- src > test > resources ë””ë ‰í† ë¦¬ ìƒì„± > [junit-platform.properties](http://junit-platform.properties) íŒŒì¼ ìƒì„±
- File > project structure > Modules > resources ë””ë ‰í† ë¦¬ë¥¼ Test Resourcesë¡œ > apply(â­ï¸)

```java
//í…ŒìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ë¼ì´í”„ì‚¬ì´í´ ì„¤ì •
junit.jupiter.testinstance.lifecycle.default = per_class

//í™•ì¥íŒ© ìë™ ê°ì§€ ê¸°ëŠ¥
junit.jupiter.extensions.autodetection.enabled = true

//@Disabled ë¬´ì‹œí•˜ê³  ì‹¤í–‰í•˜ê¸°
junit.jupiter.conditions.deactivate = org.junit.*DisabledCondition

//í…ŒìŠ¤íŠ¸ ì´ë¦„ í‘œê¸° ì „ëµ ì„¤ì •
junit.jupiter.displayname.generator.default = \
    org.junit.jupiter.api.DisplayNameGenerator$ReplaceUnderscores
```

- junit.jupiter.testinstance.lifecycle.default = per_class
    - `@TestInstance(TestInstance.Lifecylcle.PER_CLASS)` ì™€ ê°™ìŒ
    - ëª¨ë“  TESTì— `@TestInstance(TestInstance.Lifecylcle.PER_CLASS)` ì ìš©í•˜ê³  ì‹¶ì„ ë•Œ êµ¿
- junit.jupiter.conditions.deactivate = org.junit.*DisabledCondition
    - DIsabledOnOs/ DisabledOnJRE ëª¨ë‘ ê°€ëŠ¥!
- junit.jupiter.displayname.generator.default = org.junit.jupiter.api.DisplayNameGenerator$ReplaceUnderscores
    - `@DisplayNameGeneration(DisplayNameGenerator.ReplaceUnderscores.class)` ì™€ ê°™ìŒ
    - `@DisplayNameGeneration` ë³´ë‹¤ @DisplayName ì´ ìš°ì„ ìˆœìœ„ ë†’ìŒ(ì°¸ê³ â˜ğŸ»)
- \ ëŠ” ë„ˆë¬´ ê¸¸ì–´ì§€ë‹ˆê¹Œ ë‹¤ìŒ ì¤„ì— í‘œê¸°í•˜ë ¤ë©´ ë¶™ì´ê¸°

## ****ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸****

<img width="241" alt="á„€á…µá„‡á…©á†«1" src="https://github.com/Choiulmu/TIL/assets/124655364/e8a44c28-2459-45d6-b6b4-522d586cfb7e">

<img width="386" alt="á„€á…µá„‡á…©á†«2" src="https://github.com/Choiulmu/TIL/assets/124655364/e2c0b752-7fa6-4f2a-9e0d-c52778350784">

```java
@Entity
@Getter @Setter
public class Member {
...
    @ElementCollection
    @CollectionTable(name = "FAVORITE_FOOD", joinColumns =
        @JoinColumn(name = "MEMBER_ID"))
    @Column(name = "FOOD_NAME") //String í•˜ë‚˜ë§Œ ì €ì¥í•´ë„ ë˜ë‹ˆê¹Œ ì˜ˆì™¸ì  í—ˆìš©
    private Set<String> favoriteFoods = new HashSet<>();

    @ElementCollection
    @CollectionTable(name = "ADDRESS", joinColumns =
        @JoinColumn(name = "MEMBER_ID"))
    private List<Address> addressHistory = new ArrayList<>();
...
}
```

- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì»¬ë ‰ì…˜ì„ ê°™ì€ í…Œì´ë¸”ì— ì €ì¥XX 
(ex: h2databaseë¼ í•  ë•Œ addressHistory Column í•œ ì¹¸ì— ì—¬ëŸ¬ê°œì˜ Addressê°’ ì­‰ ë‚˜ì—´ ëª»í–‰)
- ì»¬ë ‰ì…˜ì„ ì €ì¥í•˜ê¸° ìœ„í•œ ë³„ë„ì˜ í…Œì´ë¸”ì´ í•„ìš”í•¨
- @ElementCollection, @CollectionTable ì‚¬ìš©
- ê°’íƒ€ì… ì»¬ë ‰ì…˜ë„ ì§€ì—° ë¡œë”© ì „ëµ ì‚¬ìš©(member persistí•˜ë©´ ìˆ˜ì •ì‚¬í•­ ë°˜ì˜ë¼~â­ï¸)

- ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì˜ í•œê³„ì™€ ëŒ€ì•ˆ
    - í•œê³„: ë³€ê²½ ë°œìƒ â†’ ì£¼ì¸ ì—”í‹°í‹°ì™€ ì—°ê´€ëœ ëª¨ë“  ë°ì´í„° ì‚­ì œ í›„ ê°’íƒ€ì… ì»¬ë ‰ì…˜ì— ìˆëŠ” í˜„ì¬ ê°’ ëª¨ë‘ ë‹¤ì‹œ ì €ì¥
    - ëŒ€ì•ˆ: ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì„ ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ëª¨ë“  ì»¬ëŸ¼ì„ ë¬¶ì–´ì„œ ê¸°ë³¸í‚¤ êµ¬ì„±: null ì…ë ¥X, ì¤‘ë³µ ì €ì¥X
    - ê°’íƒ€ì… ì»¬ë ‰ì…˜ì€ ë³€ê²½í• ê±°ë©´ ê·¸ ì„¸íŠ¸ë¥¼ ë‹¤ ê°ˆì•„ë¼ì›Œì•¼í•´ğŸ˜±
        
        ì˜ˆì‹œ) addressHistoryì— ìˆëŠ” ê°’ = {â€oldCityâ€, â€œstreetâ€, â€œ10000â€}
        ìƒí™©) ì—¬ê¸°ì„œ oldCityë¥¼ newCityë¡œ ê°ˆì•„ë¼ìš°ê³  ì‹¶ì–´
        ë°©ë²•) {â€oldCityâ€, â€œstreetâ€, â€œ10000â€} ì‚­ì œ â†’ {â€newCityâ€, â€œstreetâ€, â€œ10000â€} í†µìœ¼ë¡œ ë„£ì–´
        

- ì—”í‹°í‹° íƒ€ì…ê³¼ ê°’íƒ€ì…ì˜ íŠ¹ì§•
    
    
    | ì—”í‹°í‹° íƒ€ì… | ê°’ íƒ€ì… |
    | --- | --- |
    | - ì‹ë³„ì O
    - ìƒëª…ì£¼ê¸° ê´€ë¦¬
    - ê³µìœ  | - ì‹ë³„ì X
    - ìƒëª… ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì— ì˜ì¡´
    - íŠ¹íˆ, ê°’ íƒ€ì… ì»¬ë ‰ì…˜ì€ ì˜ì†ì„± ì „ì´(Cascade) + ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ í•„ìˆ˜
    - ê³µìœ í•˜ì§€ ì•ŠëŠ” ê±´ì´ ì•ˆì „(ë³µì‚¬í•´ì„œ ì‚¬ìš© / ë¶ˆë³€ê°ì²´) |
- ì‹¤ë¬´ì—ì„œ ê°’ íƒ€ì… ì»¬ë ‰ì…˜ ì‚¬ìš©
    - ì‹ë³„ìê°€ í•„ìš”í•˜ê³ , ì§€ì†í•´ì„œ ê°’ì„ ì¶”ì , ë³€ê²½í•´ì•¼ í•œë‹¤ë©´ ê°’íƒ€ì…ì´ ì•„ë‹Œ ì—”í‹°í‹°(â­ï¸â­ï¸)
    - ì‹¤ë¬´: ê°’íƒ€ì… ì»¬ë ‰ì…˜ â†’ ì¼ëŒ€ë‹¤ ê´€ê³„ë¡œ í’€ì–´ë‚´ê¸° + (ì˜ì†ì„± ì „ì´ + ê³ ì•„ê°ì²´ ì œê±°)

---

### ê°ì²´ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´(JPQL)

```java
try{
    em.createQuery("select m from Member m where m.name like '%ìµœìœ ë¦¼'", Member.class).getResultList();

    tx.commit();
}
...
```

<img width="375" alt="JPQL" src="https://github.com/Choiulmu/TIL/assets/124655364/814c8ea5-6fb4-4401-8f65-2e4bd91ec8d1">

- ê°ì²´ ì§€í–¥ SQL(í…Œì´ë¸”ì´ ì•„ë‹Œ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬)
- JPAë¥¼ ì‚¬ìš©í•˜ë©´ ì—”í‹°í‹° ê°ì²´ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œ â†’ ë‹¨, ê²€ìƒ‰ë„ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰
- ëª¨ë“  DB ë°ì´í„° â†’ ê°ì²´ë¡œ ë³€í™˜ ë¶ˆê°€
- So, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ í•„ìš”í•œ ë°ì´í„°ë§Œ DBì—ì„œ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê²€ìƒ‰ì¡°ê±´ì´ í¬í•¨ëœ SQL í•„ìš” â†’ JPQL
- SQL ì¶”ìƒí™” - íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ SQLì— ì˜ì¡´X

### QueryDSL

- JPQL ë¹Œë” ì—­í• 
- ì»´íŒŒì¼ ì‹œì ì— ë¬¸ë²• ì˜¤ë¥˜ ì°¾ì„ ìˆ˜ ìˆìŒ(ğŸ‘ğŸ»)
- ë™ì  ì¿¼ë¦¬ ì‘ì„± í¸ë¦¬í•¨
- [http://querydsl.com/static/querydsl/5.0.0/reference/html_single/](http://querydsl.com/static/querydsl/5.0.0/reference/html_single/)

### ë„¤ì´í‹°ë¸Œ SQL

```java
try{
     String sql = "SELECT ID, NAME FROM MEMBER WHERE NAME = 'ìµœìœ ë¦¼'";
     List<Member> resultList = em.createNativeQuery(sql, Member.class).getResultList();

      tx.commit();
}
...
```

<img width="338" alt="QDSL" src="https://github.com/Choiulmu/TIL/assets/124655364/6b75f73f-0126-4bfa-aa93-053389b921c5">


- JPAê°€ ì œê³µí•˜ëŠ” SQLì„ ì§ì ‘ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥
- JPQLë¡œ í•´ê²° ëª»í•˜ëŠ” íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´ì ì¸ ê¸°ëŠ¥
- ì˜¤ë¼í´ CONNECT BY, íŠ¹ì • DBë§Œ ì‚¬ìš©í•˜ëŠ” SQLíŒíŠ¸(â†’ í›„ìëŠ” hibernateê°€ ë°©ì–¸ ì„¤ì •í•´ì„œ í•´ê²° ê°€ëŠ¥)
- (ê°•ì‚¬ë‹˜) ë‚˜ëŠ” ë„¤ì´í‹°ë¸Œ SQLë³´ë‹¤ëŠ” SpringJdbcTemplate ì‚¬ìš©í–‰

### JDBC ì§ì ‘ ì‚¬ìš©, SpringJdbcTemplate ë“±

- springJdbcTemplate (ì¶”í›„ ê³µë¶€)
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì ì ˆí•œ ì‹œì ì— ê°•ì œë¡œ í”ŒëŸ¬ì‹œ í•„ìš”(â­ï¸)

### SQL

### Having

**`HAVING`**ê³¼ **`WHERE`**ëŠ” SQLì—ì„œ ë°ì´í„°ë¥¼ í•„í„°ë§í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ë‘ ê°€ì§€ ì ˆì…ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê·¸ë“¤ ê°„ì— ì¤‘ìš”í•œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.

1. **ì‚¬ìš©ë˜ëŠ” ìœ„ì¹˜:**
    - **`WHERE`**: **`SELECT`**, **`UPDATE`**, **`DELETE`** ë“±ì˜ ëª…ë ¹ì—ì„œ í–‰ì„ í•„í„°ë§í•©ë‹ˆë‹¤.
    - **`HAVING`**: **`GROUP BY`**ì™€ í•¨ê»˜ ì‚¬ìš©ë˜ì–´ ê·¸ë£¹í™”ëœ ê²°ê³¼ ì§‘í•©ì—ì„œ í–‰ì„ í•„í„°ë§í•©ë‹ˆë‹¤.
2. **ì ìš© ì‹œì :**
    - **`WHERE`**: ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ í–‰ì„ ì½ì–´ì˜¤ê¸° ì „ì— ì ìš©ë©ë‹ˆë‹¤.
    - **`HAVING`**: ë°ì´í„°ê°€ ì´ë¯¸ ê·¸ë£¹í™”ëœ í›„ì— ì ìš©ë©ë‹ˆë‹¤.
3. **ì¡°ê±´ ì§€ì •ì˜ ì°¨ì´**
- HAVING: ì§‘ê³„ í•¨ìˆ˜ (ì˜ˆ: COUNT, SUM)ì™€ í•¨ê»˜ ì‚¬ìš©
- WHERE: ë‹¨ì¼ í–‰ ì¡°ê±´ì„ ì§€ì •

```sql
sqlCopy code
-- WHEREë¥¼ ì‚¬ìš©í•œ ì˜ˆì œ //ì£¼ë¬¸ í…Œì´ë¸”ì—ì„œ ì´ ê°€ê²©ì´ 100 ì´ìƒì¸ ì£¼ë¬¸ì„ ì„ íƒ
SELECT * FROM orders WHERE total_price > 100;

-- HAVINGì„ ì‚¬ìš©í•œ ì˜ˆì œ //ì£¼ë¬¸ í…Œì´ë¸”ì—ì„œ ê° ê³ ê°ë³„ë¡œ ì£¼ë¬¸í•œ íšŸìˆ˜ê°€ 2íšŒ ì´ìƒì¸ ê³ ê°ì„ ì„ íƒ
SELECT customer_id, COUNT(order_id) as order_count
FROM orders
GROUP BY customer_id
HAVING order_count > 2;
```

### JOIN

**ë¬¸ì œ 2: íšŒì›ê³¼ ê·¸ íšŒì›ì´ ì£¼ë¬¸í•œ ìƒí’ˆ ì •ë³´ ê°€ì ¸ì˜¤ê¸°**

í…Œì´ë¸”: members, orders, order_items

ì—´

- members: member_id, member_name
- orders: order_id, user_id, order_date
- order_items: order_item_id, order_id, product_id, quantity

í•´ê²°ì±…

```sql
SELECT m.member_id, m.member_name, o.order_id, oi.product_id, oi.quantity
FROM members m
JOIN orders o ON m.member_id = o.user_id
JOIN order_items oi ON o.order_id = oi.order_id;
```
