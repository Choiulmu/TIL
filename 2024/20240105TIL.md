# 20240105 TIL

## ****ìë°” ORM í‘œì¤€ JPA í”„ë¡œê·¸ë˜ë° - ê¸°ë³¸í¸****

### ìƒì†ê´€ê³„ë§¤í•‘ BASE

- ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìƒì†ê´€ê³„X
- ìƒì†ê´€ê³„(ê°ì²´) - ìœ ì‚¬ - ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì… ê´€ê³„(DB)
- Item(ë¶€ëª¨) - Movie, Book, Album(ìì‹)
    
    â†’ Itemë§Œ ë”°ë¡œ ì €ì¥í•  ì¼ ì—†ë‹¤ â†’ Item ì¶”ìƒ í´ë˜ìŠ¤í™”(abstract)
    

![ìƒì†](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled.png)

ìƒì†

![ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì…](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled%201.png)

ìŠˆí¼íƒ€ì… ì„œë¸Œíƒ€ì…

### ìƒì†ê´€ê³„ ë§¤í•‘ êµ¬í˜„ ë°©ë²•1: ì¡°ì¸ ì „ëµ(â­ï¸ ì •ì„)

![Untitled](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled%202.png)

```java
@Entity
@Getter @Setter
@Inheritance(strategy = InheritanceType.JOINED)
@DiscriminatorColumn
public class Item {
...
}
```

- ë¶€ëª¨(Itemí´ë˜ìŠ¤)ì˜ ì „ëµ: `@Inheritance(strategy = InheritanceType.*JOINED*)`
- @DiscriminatorColumn
    - DTYPE column ìƒê¸°ê³  Entityì´ë¦„ ê·¸ëŒ€ë¡œ ë„£ì–´ì¤Œ
    - ì¿¼ë¦¬ë§Œ ë³´ê³  ì˜ˆìƒí•  ìˆ˜ ìˆì–´ì•¼ í•œë‹¤. â†’ ê·¸ëŸ¬ë¯€ë¡œ Entity ì´ë¦„ ê·¸ëŒ€ë¡œ ë„£ì–´ì£¼ëŠ” íš¨ê³¼ is ê¿€
    - ìì‹ì— `@DiscriminatorValue("B")` : DTYPE ì•½ìë¡œ ë“¤ì–´ê°(DBAì™€ ìƒì˜)

| ì¥ì  | - í…Œì´ë¸” ì •ê·œí™”(ì¤‘ë³µ ìµœì†Œí™”/ì¼ê´€ì„±b)
- ì™¸ë˜ í‚¤ ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ í™œìš© ê°€ëŠ¥(ì™¸ë˜ í‚¤ ì‚¬ìš©í•˜ëŠ” ì¡°ì¸ ì—°ì‚° ì‹œì— ì •í™•í•˜ê³  ì¼ê´€ëœ ê²°ê³¼ get)
- ì €ì¥ê³µê°„ íš¨ìœ¨í™” |
| --- | --- |
| ë‹¨ì  | - ì¡°íšŒì‹œ ì¡°ì¸ ë§ì´ ì‚¬ìš©, ì„±ëŠ¥ ì €í•˜(í¬ë¦¬í‹°ì»¬í•˜ì§€ëŠ” X)
- ì¡°íšŒ ì¿¼ë¦¬ ë³µì¡
- ë°ì´í„° ì €ì¥ì‹œ INSERT ì¿¼ë¦¬ 2ë²ˆ í˜¸ì¶œ |

### ìƒì†ê´€ê³„ ë§¤í•‘ êµ¬í˜„ ë°©ë²•2: ë‹¨ì¼í…Œì´ë¸” ì „ëµ

![Untitled](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled%203.png)

```java
@Entity
@Getter @Setter
@Inheritance(strategy = InheritanceType.SINGLE_TABLE)
@DiscriminatorColumn
public abstract class Item {
...
}
```

- Item/Album/Movie/Book ì—”í‹°í‹° í´ë˜ìŠ¤ êµ¬í˜„ > extendsë¡œ ìƒì†
- ë³„ë„ ì„¤ì • x â†’ @Inheritance ì „ëµì´ ê¸°ë³¸ SingleTable

| ì¥ì  | - ì¡°ì¸ í•„ìš”X â†’ ì¡°íšŒ ì„±ëŠ¥ fast
- ì¡°íšŒ ì¿¼ë¦¬ ë‹¨ìˆœ |
| --- | --- |
| ë‹¨ì  | - ìì‹ ì—”í‹°í‹°ê°€ ë§¤í•‘í•œ ì»¬ëŸ¼ ëª¨ë‘ nullí—ˆìš©(ğŸ˜±)
- ì„ê³„ì  ë„˜ìœ¼ë©´ í…Œì´ë¸”ì´ ì»¤ì ¸ ì¡°íšŒì„±ëŠ¥ ì˜¤íˆë ¤ ëŠë¦¼(ì„ê³„ì  ë„˜ëŠ” ê²½ìš° ë§ì§€ ì•Šì•„..) |

### ìƒì†ê´€ê³„ ë§¤í•‘ êµ¬í˜„ ë°©ë²•2: êµ¬í˜„ í´ë˜ìŠ¤ë§ˆë‹¤ í…Œì´ë¸” ì „ëµ

![Untitled](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled%204.png)

```java
@Entity
@Getter @Setter
@Inheritance(strategy = InheritanceType.TABLE_PER_CLASS)
public abstract class Item {
...
}
```

- Item í…Œì´ë¸” ì—†ì• ë²„ë¦¬ê³ , ê·¸ ì†ì„±ì„ ìì‹ì— ë‚´ë¦¼
- ì¡°íšŒí•  ë•Œ ITEM_IDê°€ ìˆëŠ”ì§€ ìì‹í…Œì´ë¸”ì— ë‹¤ ì°”ëŸ¬ë´„
- ì´ê±° ì‹¤ë¬´ì—ì„œ ì“°ì§€ë§ˆ(â­ï¸)

### ìƒì†ê´€ê³„ ë§¤í•‘ êµ¬í˜„ ë°©ë²• ê³ ë¯¼

- ë¹„ì¦ˆë‹ˆìŠ¤ì ìœ¼ë¡œ ì¤‘ìš”í•˜ê³  ë³µì¡í•´ + ê¸°ë³¸ì ì„ â†’ ì¡°ì¸ í…Œì´ë¸” ì „ëµ
- ë°ì´í„°ë„ ì–¼ë§ˆì—†ê³  ë‹¨ìˆœí•˜ê²Œ ê°€ë„ ë¼. í™•ì¥/ë³€ê²½ë  ì¼ë„ ì—†ì–´ â†’ ë‹¨ì¼ í…Œì´ë¸” ì „ëµ

### Mapped Superclass - ë§¤í•‘ ì •ë³´ ìƒì†

- ìƒì†ê´€ê³„ ë§¤í•‘ X(â­ï¸) / ê·¸ëƒ¥ ê³µí†µëœ ì†ì„± ê°™ì´ ì“°ê³  ì‹¶ì–´~
- ì—”í‹°í‹° X, í…Œì´ë¸”ê³¼ ë§¤í•‘X
- ë¶€ëª¨ í´ë˜ìŠ¤ ìƒì†ë°›ëŠ” ìì‹ í´ë˜ìŠ¤ì— ë§¤í•‘ ì •ë³´ë§Œ ì œê³µ
- ì¡°íšŒ ê²€ìƒ‰ ë¶ˆê°€
- ì§ì ‘ ìƒì„±í•´ì„œ ì‚¬ìš©í•  ì¼ ì—†ìœ¼ë¯€ë¡œ ì¶”ìƒ í´ë˜ìŠ¤ ê¶Œì¥(â­ï¸)
- JPAì—ì„œ extendsë¥¼ ì“¸ ë•ŒëŠ” í´ë˜ìŠ¤ì— @Entity / @MappedSuperclassê°€ ìˆëŠ” ê²½ìš°ë§Œì´ì•¼
- ìƒí™©
    - DBAğŸ§‘ğŸ»â€ğŸ’»: â€œì €í¬ ëª¨ë“  entityì— ë“±ë¡í•œ ì‚¬ëŒê³¼ ë“±ë¡í•œ ì‹œê¸°, ìˆ˜ì •í•œ ì‚¬ëŒê³¼ ìˆ˜ì • ì‹œê¸° ë‹¤ í‘œì‹œí•´ì•¼í•´ìš”â€
    - ê°œë°œìğŸ™†ğŸ»â€â™€ï¸:  ì†ì„±ì˜ ë°˜ë³µ?Mapped SupperClass ì‚¬ìš©~

---

### í”„ë¡ì‹œ BASE

- ì‹¤ì œ ì—”í‹°í‹° ê°ì²´ ëŒ€ì‹  ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ì§€ì—°í•  ìˆ˜ ìˆëŠ” ê°€ì§œ ê°ì²´
- ì‹¤ì œ í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ ë§Œë“¤ì–´ì§ - íƒ€ì… ì²´í¬ ì‹œ ì£¼ì˜(ë¹„êµ ì‹¤íŒ¨/instance of ì‚¬ìš©)

```java
..
Member findMember = em.find(Member.class, member1.getId());
Member findMember2 = em.getReference(Member.class, member2.getId());
System.out.println(findMember instanceof Member);
System.out.println(findMember2 instanceof Member);
..
```

- findMember2ëŠ” í”„ë¡ì‹œë¥¼ í†µí•´ ê°€ì ¸ì™”ìŒ
- í•˜ì§€ë§Œ ê·¸ í”„ë¡ì‹œë„ Memberë¥¼ ìƒì†ë°›ì•„ ë§Œë“¬
- instanceof í•˜ë©´ ë˜‘ê°™ì•„ìš”~~

### í”„ë¡ì‹œ íŠ¹ì§•

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-05 á„‹á…©á„’á…® 5.17.46.png](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-05_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_5.17.46.png)

- ì‹¤ì œ í´ë˜ìŠ¤ì™€ ê²‰ëª¨ì–‘ same
- ì§„ì§œ ê°ì²´ì¸ì§€ í”„ë¡ì‹œ ê°ì²´ì¸ì§€ êµ¬ë¶„í•„ìš”X
- ì‹¤ì œ ê°ì²´ì˜ ì°¸ì¡°(target)ë³´ê´€
- í”„ë¡ì‹œ ê°ì²´ë¥¼ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œ(â­ï¸)

- ì‹¤ì œ entityë¥¼ DBì—ì„œ ì¡°íšŒí•œ ì ì´ ì—†ë‹¤ë©´ ì²˜ìŒì—” proxyì— targetì—†ë‹¤

### í”„ë¡ì‹œ ê°ì²´ì˜ ì´ˆê¸°í™”

![Untitled](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled%205.png)

```java
Member member = em.getReference(Member.class, "id1");
member.getName();
```

- í”„ë¡ì‹œ ê°ì²´ëŠ” ì²˜ìŒ ì‚¬ìš©í•  ë•Œ í•œë²ˆë§Œ ì´ˆê¸°í™” â†’ ì´ˆê¸°í™”ë˜ë©´ ì‹¤ì œ ì—”í‹°í‹°ì— ì ‘ê·¼ ê°€ëŠ¥
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì°¾ëŠ” ì—”í‹°í‹°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ em.getReference()í˜¸ì¶œí•´ë„ ì‹¤ì œ ì—”í‹°í‹° ë°˜í™˜
    - B1. ì´ë¯¸ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ 1ì°¨ìºì‹œì— ì˜¬ë ¤ë‘” ê±° êº¼ë‚´ì˜¤ë©´ ë˜ëŠ”ê±°ì§€. êµ³ì´ í”„ë¡ì‹œ ì”€?
    - B2. JPAì˜ ì›ì¹™: a == a ë•Œë¬¸
- ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë„ì›€ ëª» ë°›ëŠ” ìƒíƒœ(ì¤€ì˜ì† ìƒíƒœ)ì¼ ëŒ€, í”„ë¡ì‹œ ì´ˆê¸°í™” â†’ ë¬¸ì œ ë°œìƒ(LazyInitializationException ì˜ˆì™¸)

| í”„ë¡ì‹œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸°í™” ì—¬ë¶€ í™•ì¸ | PersistenceUnitUtil.isLoaded(Object entity) |
| --- | --- |
| í”„ë¡ì‹œ í´ë˜ìŠ¤ í™•ì¸ ë°©ë²• | entity.getClass().getName() ì¶œë ¥(..javasist.. or HibernateProxyâ€¦) |
| í”„ë¡ì‹œ ê°•ì œ ì´ˆê¸°í™” | org.hibernate.Hibernate.initialize(entity);
* ì°¸ê³ : JPA í‘œì¤€ì€ ê°•ì œ ì´ˆê¸°í™” ì—†ìŒ |

### ì¦‰ì‹œë¡œë”©ê³¼ ì§€ì—°ë¡œë”© BASE

- (fetch = FetchType.*LAZY*) ì§€ì—°ë¡œë”©ì‹œ, í”„ë¡ì‹œë¡œ ì¡°íšŒ
- ì¦‰ì‹œ ë¡œë”© (fetch = FetchType.EAGER)
    - Member ê°€ì ¸ì˜¬ ë•Œ Teamë„ join
    - ëŒ€ë¶€ë¶„ member ì“¸ ë•Œ teamì“´ë‹¤.
- ì§€ì—°ë¡œë”©ë§Œ ì“°ì…ˆ!!!!!!!!!!!!!!! â†’ í•„ìš”í•˜ë©´ JPQL fetchì¡°ì¸, ì—”í‹°í‹° ê·¸ë˜í”„ ê¸°ëŠ¥ í™œìš©
- @XToOne(@ManyToOne, @OneToOne)ì€ ê¸°ë³¸ì´ ì¦‰ì‹œ ë¡œë”© -> LAZYë¡œ ì„¤ì •
- em.find() vs em.getReference()
    - em.find(): ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ì„œ ì‹¤ì œ ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ
    - em.getReference(): ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ë¯¸ë£¨ëŠ” ê°€ì§œ(í”„ë¡ì‹œ)ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ
- ì¦‰ì‹œë¡œë”©ì€ JPQLì—ì„œ N+1 ë¬¸ì œ
- n+1ë¬¸ì œ
    
    ```jsx
    @Entity
    @Table(name = "orders")
    @Getter @Setter
    public class Order {
    
        @Id @GeneratedValue
        @Column(name = "order_id")
        private Long id;
    
        @ManyToOne(fetch = FetchType.EAGER)
        @JoinColumn(name = "member_id")
        private Member member;
    
    }
    ```
    
    - ë‹¨ê±´ì¡°íšŒì—ì„œëŠ” ë¬¸ì œX
    - (JPQL) select o From order o; â†’ (SQL) select * from order
    - orderê°€ 100ê°œë©´ orderì— ë”°ë¥¸ memberë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ì„œ ì¿¼ë¦¬ 100ê°œ ë‚ ë¦¼ â†’ n + 1(ì²«ë²ˆì§¸ ë‚ ë¦° ì¿¼ë¦¬ê°€ nê°œ)

### ì˜ì†ì„± ì „ì´(CASCADE)

- íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ ë•Œ ì—°ê´€ëœ ì—”í‹°í‹°ë„ í•¨ê»˜ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ê³  ì‹¶ì„ ë•Œ í™œìš©
    
    ex) ë¶€ëª¨ ì—”í‹°í‹° ì €ì¥ì‹œ, ìì‹ ì—”í‹°í‹°ë„ ì €ì¥
    
    ![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-01 á„‹á…©á„’á…® 9.15.04.png](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-01_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_9.15.04.png)
    
- ì–¸ì œ ì¨ì•¼ í•˜ëŠ”ê°€?
    - ìì‹ entityì˜ ì†Œìœ ì(ë¶€ëª¨)ê°€ ì˜¤ì§ í•˜ë‚˜ ì¼ë•Œ(â­ï¸ê²Œì‹œíŒ - ì²¨ë¶€íŒŒì¼)
    - Parentì™€ childì˜ lifecycleì´ ê±°ì˜ ìœ ì‚¬í•  ë•Œ
- CASCADE ì¢…ë¥˜
    
    
    | ALL | ëª¨ë‘ ì ìš© | MERGE | ë³‘í•© |
    | --- | --- | --- | --- |
    | PERSIST | ì˜ì† | REFRESH | REFRESH |
    | REMOVE | ì‚­ì œ | DETACH | DETACH |
- ì—°ê´€ ê´€ê³„ ë° ì¦‰ì‹œ/ì§€ì—°ë¡œë”©ê³¼ ê´€ê³„ **ç„¡**

### ê³ ì•„ ê°ì²´

- ê³ ì•„ ê°ì²´ ì œê±°: ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì§„ ìì‹ ì—”í‹°í‹°ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œ
- orphanRemoval = true
- ìì‹ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ë¶€ëª¨ê°ì²´ê°€ í•˜ë‚˜ì¼ ë•Œë§Œ ì‚¬ìš©(â­ï¸)

### ì˜ì†ì„± ì „ì´ + ê³ ì•„ ê°ì²´ í™œìš©ì‹œ ë‚˜íƒ€ëŠ” ë³€í™”

- ë³¸ë˜ entityëŠ” ê° ì—”í‹°í‹° ë§¤ë‹ˆì €ì— ì˜í•´ ê´€ë¦¬ ë¨
- CascadeType.ALL+orphanRemoval=true â†’ ì—”í‹°í‹° ë§¤ë‹ˆì €ê°€ ì•„ë‹Œ â€œë¶€ëª¨ ì—”í‹°í‹°â€ë¥¼ í†µí•´ì„œ ìì‹ì˜ ìƒëª… ì£¼ê¸° ê´€ë¦¬ ê°€ëŠ¥
- ë„ë©”ì¸ ì£¼ë„ ì„¤ê³„ì˜ Aggregate Root ê°œë… êµ¬í˜„ì— ìœ ìš©

---

### JPAë°ì´í„° íƒ€ì… ë¶„ë¥˜

- ì—”í‹°í‹° íƒ€ì…(@Entityë¡œ ì •ì˜í•˜ëŠ” ê°ì²´)
    - ë°ì´í„°ê°€ ë³€í•´ë„ ì‹ë³„ìë¡œ ì§€ì†í•´ì„œ ì¶”ì  ê°€ëŠ¥
    - ex) íšŒì› ì—”í‹°í‹°ì˜ í‚¤ë‚˜ ë‚˜ì´ ê°’ ë³€ê²½í•´ë„ ì‹ë³„ìë¡œ ì¸ì‹ ê°€ëŠ¥
- ê°’íƒ€ì…
    - int, integer, Stringì²˜ëŸ¼ ë‹¨ìˆœíˆ ê°’ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ìë°”ì˜ ê¸°ë³¸ íƒ€ì…ì´ë‚˜ ê°ì²´
    - ì‹ë³„ìX Onlyê°’ â†’ ì¶”ì  ë¶ˆê°€
    - ex) 100ì„ 200ìœ¼ë¡œ ë³€ê²½ â†’ ì „ì— 100ì´ì—ˆëŠ”ì§€ 0ì´ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ì–´. ì¶”ì  ëª»í–‰
    - ìƒëª…ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì— ì˜ì¡´(ì—”í‹°í‹° ìƒì„±ë˜ë©´ ê°’ ë“¤ì–´ì˜¤ê³ , ì—”í‹°í‹° ì£½ìœ¼ë©´ ì£½ìŒ)
    - ê¸°ë³¸ê°’ íƒ€ì…(ìë°” ê¸°ë³¸íƒ€ì…, ë˜í¼í´ë˜ìŠ¤, String)/ì„ë² ë””ë“œ íƒ€ì…/ì»¬ë ‰ì…˜ ê°’ íƒ€ì…
    - ì ˆëŒ€ ë¶ˆë³€ ê°ì²´ë¡œ ë§Œë“¤ì–´!!!!(â­ï¸)

### ê°’íƒ€ì… - ê¸°ë³¸ê°’ íƒ€ì…

- ìƒëª…ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì— ì˜ì¡´(ì—”í‹°í‹° ìƒì„±ë˜ë©´ ê°’ ë“¤ì–´ì˜¤ê³ , ì—”í‹°í‹° ì£½ìœ¼ë©´ ì£½ìŒ - like í•´ë³‘ëŒ€?)
- ê°’ íƒ€ì…ì€ ê³µìœ í•˜ë©´X
- ìë°”ì˜ ê¸°ë³¸ íƒ€ì…(int, double ë“±)ì€ ì ˆëŒ€ ê³µìœ X
- ë˜í¼í´ë˜ìŠ¤(Integer ë“±), Stringì€ ê³µìœ  ê°€ëŠ¥í•˜ë‚˜ ë³€ê²½ ì ˆëŒ€ ì•ˆë˜ê²Œ ë˜ì–´ìˆìŒ

### ê°’íƒ€ì… - ì„ë² ë””ë“œ íƒ€ì…(ë³µí•© ê°’íƒ€ì…)

- **ì ˆëŒ€ ë¶ˆë³€ ê°ì²´ë¡œ ë§Œë“¤ì–´!!!!(â­ï¸)**
- ìƒëª…ì£¼ê¸°ë¥¼ ì—”í‹°í‹°ì— ì˜ì¡´(ì—”í‹°í‹° ìƒì„±ë˜ë©´ ê°’ ë“¤ì–´ì˜¤ê³ , ì—”í‹°í‹° ì£½ìœ¼ë©´ ì£½ìŒ)

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-01-05 á„‹á…©á„’á…® 7.10.15.png](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2024-01-05_%25E1%2584%258B%25E1%2585%25A9%25E1%2584%2592%25E1%2585%25AE_7.10.15.png)

![Untitled](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled%206.png)

- @Embeddable: ê°’ íƒ€ì…ì„ ì •ì˜í•˜ëŠ” ê³³ì— í‘œì‹œ â†’ Period/Address
- @Embedded: ê°’ íƒ€ì…ì„ ì‚¬ìš©í•˜ëŠ” ê³³ì— í‘œì‹œâ†’ Member ì—”í‹°í‹°ì˜ Periodí•„ë“œ/Addressí•„ë“œ
- ê¸°ë³¸ ìƒì„±ì í•„ìˆ˜(â­ï¸)
- ì¥ì : ì¬ì‚¬ìš©, ë†’ì€ ì‘ì§‘ë„, í•´ë‹¹ ê°’ íƒ€ì…ë§Œ ì‚¬ìš©í•˜ëŠ” ì˜ë¯¸ ìˆëŠ” ë©”ì†Œë“œ ë§Œë“¤ ìˆ˜ ìˆìŒ
(í˜„ì¬ ì¼í•˜ê³  ìˆëŠ”ì§€/ì–¼ë§ˆë‚˜ ì¼í–ˆëŠ”ì§€ ê³„ì‚°í•˜ëŠ” ë©”ì„œë“œ periodë‚´ ë§Œë“¤ ìˆ˜ ìˆë‹¤)
- ì„ë² ë””ë“œ íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° ì „ê³¼ í›„ì— ë§¤í•‘í•˜ëŠ” í…Œì´ë¸”ì€ ê°™ë‹¤.
- ì„ë² ë””ë“œ íƒ€ì…ì˜ ê°’ì´ nullì´ë©´ ë§¤í•‘í•œ ì»¬ëŸ¼ ê°’ì€ ëª¨ë‘ null
    
    (ì•„ë˜ì½”ë“œì—ì„œ private Address homeAddress = null; í•˜ë©´ ê± ë‚´ë¶€ colums ëª¨ë‘ null)
    
- @AttributeOverride/@AttributeOverrides
    - í•œ ì—”í‹°í‹°ì—ì„œ ê°™ì€ ê°’íƒ€ì… ì‚¬ìš©í•˜ë©´? ì»¬ëŸ¼ ëª… ì¤‘ë³µ â†’ ì—ëŸ¬
    - ex) Memberì—ì„œ Addressíƒ€ì…ì„ Memberì˜ ì§‘Address / ê·¼ë¬´ì§€Address
    
    ```java
    @Entity
    @Getter @Setter
    public class Member {
    
        ..
        @Embedded
        private Address homeAddress;
    
        @Embedded
        @AttributeOverrides({
                @AttributeOverride(name="city",
                        column = @Column(name = "WORK_CITY")),
                @AttributeOverride(name="street",
                        column = @Column(name = "WORK_STREET")),
                @AttributeOverride(name="zipcode",
                        column = @Column(name = "WORK_ZIPCODE"))       
        })
        private Address workAddress;
        ..
    
    }
    ```
    

### ê°’íƒ€ì… = ë¶ˆë³€ê°ì²´

- ì„ë² ë””ë“œ íƒ€ì…ê°™ì€ ê°’ íƒ€ì…ì„ ì—¬ëŸ¬ ì—”í‹°í‹°ì—ì„œ ê³µìœ í•˜ë©´ ìœ„í—˜(side effect)

![Untitled](20240105%20TIL%20a7cd2225ec1d4c7e8f6df63a99741e53/Untitled%207.png)

- ì™¼ìª½ ì½”ë“œ: member2ë§Œ ë°”ë€ŒëŠ” ê²Œ ì•„ë‹ˆë¼
member1ë„ ê± ìë™ìœ¼ë¡œ ë°”ë€œ
- ë‚œ ì›ë˜ í•œë²ˆì— ë‹¤ ë°”ë€ŒëŠ” ê±¸ ì›í–ˆì–´ğŸ™‹ğŸ»
â†’ ì•„ ê·¸ëŸ¬ë©´ Addressë¥¼ Entityë¡œ ì“°ì‹œë¼ê³ ìš”
- ë‚œ ì›í•˜ì§€ ì•Šì•˜ì–´ í‘í‘
â†’ ì•„ ê·¸ëŸ¬ë©´ ë¶ˆë³€ê°ì²´ë¡œ ë§Œë“œì‹œë¼ê³ ìš”~

```java
Address address = new Address("city", "street", "111111");
Member member1 = new Member();
member1.setName("ìµœìœ ë¦¼");
member1.setHomeAddress(address);
em.persist(member1);

Member member2 = new Member();
member2.setName("ìµœìœ ë¦¼");
member2.setHomeAddress(address);
em.persist(member2);

member2.getHomeAddress().setCity("newCity");
```

- ë¶ˆë³€ ê°ì²´ë¡œ ë§Œë“œëŠ” ë°©ë²•
    - ì„ë² ë””ë“œ íƒ€ì…ì—ì„œ setter ëºì–´!(ì••ìˆ˜)
    - setter privateìœ¼ë¡œ ë§Œë“œì„¸ìš©

- ë¶ˆë³€ ê°ì²´ ê°’ ë°”ê¾¸ëŠ” ë°©ë²• â‡’ ê·¸ëƒ¥ ì„ë² ë””ë“œ íƒ€ì… ê°ì²´(Address)ë¥¼ í†µìœ¼ë¡œ ê°ˆì•„ì•¼ í•¨.

```java
Address address = new Address("city", "street", "111111");
Member member1 = new Member();
member1.setName("ìµœìœ ë¦¼");
member1.setHomeAddress(address);
em.persist(member1);

Address newAddress = new Address("Newcity", member1.getHomeAddress().getStreet(), member1.getHomeAddress().getZipcode());
member1.setHomeAddress(newAddress);
em.persist(member1
```

### ê°’ íƒ€ì…ì˜ ë¹„êµ

- ê°’ íƒ€ì…: ì¸ìŠ¤í„´ìŠ¤ ë‹¬ë¼ë„ ê·¸ ì•ˆì— ê°’ì´ ê°™ìœ¼ë©´ ê°™ì€ ê²ƒìœ¼ë¡œ ë´ì•¼í•´
- ê°’íƒ€ì…ì€ ë™ì¼ì„±(==)ë¹„êµì•„ë‹ˆë¼ ë™ë“±ì„± ë¹„êµ(.equals())í•´ì•¼í•´
- ê°’íƒ€ì…ì˜ equals()ë©”ì†Œë“œ ì¬ì •ì˜ (B.equals()ê¸°ë³¸ì´ ë™ë“±ì„±(==)ë¹„êµì„)
- (mac) control + enter

### ê°’íƒ€ì… ì»¬ë ‰ì…˜

- ê¸°ë³¸ ì»¬ë ‰ì…˜ í•˜ìœ„ì— ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥: Set, Listâ€¦