# 2023.11.16(ìˆ˜) TIL

<aside>
ğŸ—£ï¸ **Yc Tech Academyì—ì„œ í”„ë¡œì íŠ¸ ì „, ì‡¼í•‘ëª° ì‹œìŠ¤í…œ ì¼ë¶€ êµ¬í˜„í•´ë³´ê¸°**

- ë°±ê²¬ë¶ˆì—¬ì¼íƒ€ ìŠ¤í”„ë§ ë¶€íŠ¸ ì‡¼í•‘ëª° í”„ë¡œì íŠ¸ with JPA (ë³€êµ¬í›ˆ)
- êµ¬í˜„ ê³¼ì • ì¤‘ ì˜ë¬¸ì ì´ ìƒê²¨ì„œ í•´ê²°í•œ ë¶€ë¶„, ìƒˆë¡œ ì•Œê²Œëœ ë¶€ë¶„ì„ ê°„ë‹¨í•˜ê²Œ ê¸°ë¡í•´ë‘ì—ˆìŠµë‹ˆë‹¤.
</aside>

1. toString() ë©”ì„œë“œ
- ì›ë˜ â€˜ê°ì²´ì˜ í´ë˜ìŠ¤ ì´ë¦„ & í•´ì‹œ ì½”ë“œ(ê°ì²´ë“¤ì„ êµ¬ë³„í•˜ê¸° ìœ„í•œ ì •ìˆ˜ê°’) ë°˜í™˜â€™
- @Overideí•´ì„œ í´ë˜ìŠ¤ ë‚´ í•„ë“œ ì •ë³´ë¥¼ soutí•´ì£¼ëŠ” ë©”ì„œë“œë¡œ í™œìš©
- ì‚¬ìš© ì˜ˆì‹œ
    
    ```java
    public class Person {
        private String name;
        private int age;
    
        public Person(String name, int age) {
            this.name = name;
            this.age = age;
        }
    
        // toString ë©”ì„œë“œë¥¼ ì¬ì •ì˜
        @Override
        public String toString() {
            return "Person{name='" + name + "', age=" + age + '}';
        }
    ```
    
1. @Entity ì–´ë…¸í…Œì´ì…˜
- ì´ë¥¼ ë¶™ì´ë©´ í•´ë‹¹ í´ë˜ìŠ¤ = JPA ì—”í„°í‹°ë¡œ ì§€ì •
- JPAê°€ ê´€ë¦¬í•˜ëŠ” ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œ í•´ë‹¹ ê°ì²´(í´ë˜ìŠ¤)ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ë§¤í•‘ /ê´€ë¦¬
- JPAì˜ ddl-auto ì†ì„±: ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìƒì„± ë° ê°±ì‹  ì œì–´ â†’ runí•  ë•Œë§ˆë‹¤ í…Œì´ë¸” ìƒì„±/ê°±ì‹  ì—¬ë¶€ ê²°ì •

```java
//application.properties//

spring.jpa.properties.hibernate.show_sql=true

spring.jpa.properties.hibernate.format_sql=true

logging.level.org.hibernate.type.descriptor.sql=trace

spring.jpa.hibernate.ddl-auto=create
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect

```

1. ë‹¤ëŒ€ë‹¤ ë§¤í•‘ê´€ê³„
- ì‹¤ë¬´ì—ì„œëŠ” ì˜ ì‚¬ìš©X(ì—°ê²° í…Œì´ë¸”ì— ì»¬ëŸ¼ì„ ì¶”ê°€í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸)
- ì‹¤ë¬´ì—ì„œëŠ” ì—°ê²°í…Œì´ë¸” ìƒì„±í•´ì„œ ì¼ëŒ€ë‹¤/ë‹¤ëŒ€ì¼ ê´€ê³„ë¡œ í’€ì–´ëƒ„

1. ë§¤í•‘ ì—°ê²°
- ë‹¨ë°©í–¥ ë§¤í•‘ ì„¤ê³„ í›„, ë‚˜ì¤‘ì— í•„ìš”í•œ ê²½ìš° ì–‘ë°©í–¥ ë§¤í•‘ ì—°ê²°
- í…Œì´ë¸”ì€ ì™¸ë˜í‚¤ë¡œ ì¡°ì¸í•˜ëŠ” ê²½ìš°, ì–‘ë°©í–¥ ì¡°íšŒ ê°€ëŠ¥
- ì—”í‹°í‹°ëŠ” í…Œì´ë¸”ê³¼ ë‹¬ë¦¬ ì™¸ë˜í‚¤ ì¡°ì¸í•´ë„ ì–‘ë°©í–¥ ì¡°íšŒX
    - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸: ì™¸ë˜í‚¤(FK) ìˆëŠ” ê³³
    - ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(FK ìˆëŠ” ê³³)ì´ ì™¸ë˜í‚¤ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •, ì‚­ì œ)
    - ì£¼ì¸ì´ ì•„ë‹Œ ìª½(FKì—†ëŠ” ê³³)ì€ ì—°ê´€ ê´€ê³„ ë§¤í•‘ ì‹œ mappedBy ì†ì„±ì˜ ê°’ìœ¼ë¡œ ì—°ê´€ ê´€ê³„ì˜ ì£¼ì¸ì„ ì„¤ì •
    - ì£¼ì¸ì´ ì•„ë‹Œ ìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥
    
1. ì˜ì†ì„± ì „ì´(casecade)
    - ì—”í‹°í‹°ì˜ ìƒíƒœë¥¼ ë³€ê²½í•  ë•Œ í•´ë‹¹ ì—”í‹°í‹°ì™€ ì—°ê´€ëœ ì—”í‹°í‹°ì˜ ìƒíƒœ ë³€í™”ë¥¼ ì „íŒŒì‹œí‚¤ëŠ” ì˜µì…˜
    - ë¶€ëª¨: One, ìì‹: Many
    
    ex) Order(One- ë¶€ëª¨), Orderitem(Many - ìì‹)
    
    Order ì—”í‹°í‹°ê°€ ì‚­ì œ â†’ Orderitem ì—”í‹°í‹°ë„ ì‚­ì œ
    
    Order ì—”í‹°í‹°ê°€ ì €ì¥ â†’ Orderitem ì—”í‹°í‹°ë„ ì €ì¥
    
2. ì‹¤ë¬´ì—ì„œëŠ” ì¦‰ì‹œ ë¡œë”© X, ì§€ì—° ë¡œë”© ë°©ì‹ ì‚¬ìš©(FetchType.LAZY)

1. SecurityConfig - `@EnableWebSecurity` 

```java
package com.shop.config;

importë¬¸..

@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    @Override
    protected void configure(HttpSecurity http) throws Exception{

    }

  @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
}
```

- ì‚¬ìš© ì‹œ, Spring Securityì˜ ê¸°ë³¸ ì„¤ì • ì ìš© â†’ ëª¨ë“  ìš”ì²­ì€ ì¸ì¦ í•„ìš”
- ì‚¬ìš©ì ì§€ì • ë³´ì•ˆ ì„¤ì •ì´ í•„ìš”í•œ ê²½ìš°: **`WebSecurityConfigurerAdapter`** í´ë˜ìŠ¤ë¥¼ ìƒì†ë°›ì•„ì„œ **`configure`** ë©”ì„œë“œë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ í•„ìš”í•œ ë³´ì•ˆ ì„¤ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- íŠ¹ì • URL íŒ¨í„´ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œ, ë¡œê·¸ì¸ í˜ì´ì§€, ë¡œê·¸ì•„ì›ƒ ë“±ì„ êµ¬ì„±

1. `@TestPropertySource(locations = "classpath:application-test.properties")` 

```java
package com.shop.repository;

importë¬¸.

@SpringBootTest
@TestPropertySource(locations = "classpath:application-test.properties")
class ItemRepositoryTest {

 // ** í…ŒìŠ¤íŠ¸ ì½”ë“œë“¤ ** //

}
```

- í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ íŠ¹ì • í”„ë¡œí¼í‹° íŒŒì¼ ì‚¬ìš©í•˜ë„ë¡ ì§€ì •
- **`application.properties`** ëŒ€ì‹ ì— ì§€ì •ëœ í…ŒìŠ¤íŠ¸ìš© í”„ë¡œí¼í‹° íŒŒì¼ì„ ì‚¬ìš© ê°€ëŠ¥

1. **í–¥ìƒëœ forë¬¸** ë˜ëŠ” **foreachë¬¸**

```java
@Test
    @DisplayName("ìƒí’ˆëª… ì¡°íšŒ í…ŒìŠ¤íŠ¸")
    public void findByItemNmTest(){
        this.createItemList(); //item ì •ë³´ë¥¼ itemRepositoryì— saveí•˜ëŠ” ë©”ì„œë“œ
        List<Item> itemList = itemRepository.findByItemNm("í…ŒìŠ¤íŠ¸ ìƒí’ˆ1");
        for(Item item : itemList){
            System.out.println(item.toString());
        }
    }
```

- **`for(Item item : itemList)` : `itemList`** ì•ˆì— ìˆëŠ” ê°ê°ì˜ **`Item`** ê°ì²´ë¥¼ ì°¨ë¡€ëŒ€ë¡œ ê°€ì ¸ì™€ì„œ **`item`** ë³€ìˆ˜ì— í• ë‹¹í•©ë‹ˆë‹¤.
- test ì¡°ê±´ì— ë§ëŠ” ë³€ìˆ˜ëŠ” ì•Œì•„ì„œ ì¶œë ¥ë¨

1. Querydsl ì¡°íšŒ í…ŒìŠ¤íŠ¸ ì½”ë“œ

```java
@Test
    @DisplayName("Querydsl ì¡°íšŒ í…ŒìŠ¤íŠ¸1")
    public void queryDslTest(){
        this.createItemList();
        JPAQueryFactory queryFactory = new JPAQueryFactory(em);
        QItem qItem = QItem.item;
        JPAQuery<Item> query = queryFactory.selectFrom(qItem)
                .where(qItem.itemSellStatus.eq(ItemSellStatus.SELL))
                .where(qItem.itemDetail.like("%" + "í…ŒìŠ¤íŠ¸ ìƒí’ˆ ìƒì„¸ ì„¤ëª…" + "%"))
                .orderBy(qItem.price.desc());

        List<Item> itemList = query.fetch();

        for(Item item : itemList){
            System.out.println(item.toString());
        }
    }
```

- `this.createItemList();` : ì—¬ëŸ¬ê°œì˜ item ê°ì²´ë¥¼ itemRepositoryì— saveí•˜ëŠ” ë©”ì„œë“œ(ì‚¬ì „ ì„¤ê³„)
- `JPAQueryFactory queryFactory = new JPAQueryFactory(em);`
    - `JPAQueryFactory` ê°ì²´ ìƒì„±.
    - queryFactory ê°ì²´ëŠ” Querydslì„ ì‚¬ìš©í•˜ì—¬ JPA ì¿¼ë¦¬ ìƒì„± ë° ì‹¤í–‰ì— í•„ìš”í•œ ë„êµ¬
    - `em`ì€ `EntityManager`ë¡œ, JPA ì—”í„°í‹°ì™€ ìƒí˜¸ ì‘ìš©í•˜ëŠ” ë° ì‚¬ìš©
- `QItem qItem = QItem.item;`
    - Item entityì˜ Querydsl Query íƒ€ì…ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ `QItem` íƒ€ì…ì˜ ê°ì²´ë¥¼ ìƒì„±
    - `QItem`ì€ `Item` ì—”í„°í‹°ì— ëŒ€í•œ Querydsl Query íƒ€ì…ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
- `queryFactory.selectFrom(qItem)`: `qItem`ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ `select` ë¬¸(`FROM item` )
- `List<Item> itemList = query.fetch()`: ìƒì„±í•œ JPA ì¿¼ë¦¬ ì‹¤í–‰ ë° ê²°ê³¼ ë°˜í™˜
    - `fetch()`  : ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¥¼ ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜

10-2. ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œ ê¸°ëŠ¥ì„ í•˜ëŠ” ì‹¤ì œ ì½”ë“œ

```java
import com.querydsl.core.types.dsl.StringPath;
import com.querydsl.core.types.dsl.StringExpression;
import com.querydsl.jpa.impl.JPAQueryFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import java.util.List;

@Repository
public class ItemRepository {

    private final JPAQueryFactory queryFactory;
    private final QItem qItem = QItem.item;

    @Autowired
    public ItemRepository(JPAQueryFactory queryFactory) {
        this.queryFactory = queryFactory;
    }

    public List<Item> findItemsByDetailAndSellStatus(String itemDetail, ItemSellStatus itemSellStatus) {
        return queryFactory
                .selectFrom(qItem)
                .where(qItem.itemDetail.like("%" + itemDetail + "%")
                        .and(qItem.itemSellStatus.eq(itemSellStatus)))
                .orderBy(qItem.price.desc())
                .fetch();
    }
}
```

11-1. ìƒí’ˆ Querydsl ì¡°íšŒ í…ŒìŠ¤íŠ¸ 2

```java
@Test
@DisplayName("ìƒí’ˆ Querydsl ì¡°íšŒ í…ŒìŠ¤íŠ¸ 2")
public void queryDslTest2(){

    // ìƒí’ˆ ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ë©”ì„œë“œ í˜¸ì¶œ
    this.createItemList2();

    // Querydslì„ í™œìš©í•˜ê¸° ìœ„í•œ BooleanBuilderì™€ QItem ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    BooleanBuilder booleanBuilder = new BooleanBuilder();
    QItem item = QItem.item;

    // ê²€ìƒ‰ ì¡°ê±´ì„ ìœ„í•œ ë³€ìˆ˜ ì´ˆê¸°í™”
    String itemDetail = "í…ŒìŠ¤íŠ¸ ìƒí’ˆ ìƒì„¸ ì„¤ëª…";
    int price = 10003;
    String itemSellStat = "SELL";

    // BooleanBuilderì— ë™ì ìœ¼ë¡œ ê²€ìƒ‰ ì¡°ê±´ ì¶”ê°€
		booleanBuilder.and(item.itemDetail.like("%" + "itemDetail" + "%"));
    booleanBuilder.and(item.price.gt(price));

    // itemSellStatì´ "SELL"ì¼ ë•Œ ì¶”ê°€ì ì¸ ì¡°ê±´ì„ BooleanBuilderì— ì¶”ê°€
    if(StringUtils.equals(itemSellStat, ItemSellStatus.SELL)){
        booleanBuilder.and(item.itemSellStatus.eq(ItemSellStatus.SELL));
    }

    // í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ ì„¤ì •
    Pageable pageable = PageRequest.of(0, 5);

    // Querydslì„ ì‚¬ìš©í•˜ì—¬ ë™ì ìœ¼ë¡œ ìƒì„±ëœ ì¿¼ë¦¬ ì‹¤í–‰
    Page<Item> itemPageResult = itemRepository.findAll(booleanBuilder, pageable);

    // ì‹¤í–‰ ê²°ê³¼ ì¶œë ¥
    System.out.println("total elements : " + itemPageResult.getTotalElements());

    // ê²°ê³¼ ëª©ë¡ì„ ê°€ì ¸ì™€ì„œ ì¶œë ¥
    List<Item> resultItemList = itemPageResult.getContent();
    for(Item resultItem: resultItemList){
        System.out.println(resultItem.toString());
    }
}
```

- `BooleanBuilder`
    - ì¿¼ë¦¬ì— ë“¤ì–´ê°ˆ ì¡°ê±´ì„ ë§Œë“¤ì–´ì£¼ëŠ” ë¹Œë”
    - `booleanBuilder.and(...)` : ë¶€ìš¸ í‘œí˜„ì‹ì— ìƒˆë¡œìš´ ì¡°ê±´ì„ ì¶”ê°€
- `Predicate` :  ì°¸ ë˜ëŠ” ê±°ì§“ì˜ ì¡°ê±´ì„ ë‚˜íƒ€ë‚´ëŠ” í•¨ìˆ˜
- `StringUtils.equals(CharSequence str1, CharSequence str2)`
    - `null`ì„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
    - ë‘ ë¬¸ìì—´ì´ ë™ì¼í•˜ë©´ `true` ë°˜í™˜
    - ë‘˜ ì¤‘ í•˜ë‚˜ ì´ìƒì˜ ë¬¸ìì—´ì´ `null`ì´ë©´ `false`ë¥¼ ë°˜í™˜
- `booleanBuilder.and(item.price.gt(price));` : gtëŠ” greater than(ë³´ë‹¤ ë” í°)
- í˜ì´ì§€ ë„¤ì´ì…˜: ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•  ë•Œ, ë°ì´í„°ë¥¼ ì—¬ëŸ¬ í˜ì´ì§€ë¡œ ë‚˜ëˆ„ì–´ í‘œì‹œí•˜ëŠ” ê¸°ìˆ 
- `Pageable pageable = PageRequest.of(0, 5);` : ì²« ë²ˆì§¸ ì¸ìëŠ” ì¡°íšŒí•  í˜ì´ì§€ ë²ˆí˜¸, ë‘ ë²ˆì§¸ ì¸ìëŠ” í•œ í˜ì´ì§€ë‹¹ ì¡°íšŒí•  ë°ì´í„° ê°œìˆ˜
- `Page<Item> itemPageResult = itemRepository.findAll(booleanBuilder, pageable);`
: QueryDslPredicateExecutor ì¸í„°í˜ì´ìŠ¤ì—ì„œ ì •ì˜í•œ findAll()ë©”ì†Œë“œë¥¼ ì´ìš©í•´ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ë¥¼ Page ê°ì²´ë¡œ ë°›ì•„ì˜´

11-2. ìƒí’ˆ Querydsl ì¡°íšŒ í…ŒìŠ¤íŠ¸2 êµ¬í˜„

```java
import com.querydsl.core.types.dsl.BooleanExpression;
import com.querydsl.jpa.impl.JPAQueryFactory;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.Pageable;
import org.springframework.stereotype.Repository;

import javax.persistence.EntityManager;

import java.util.List;

@Repository
public class ItemRepository {

    private final JPAQueryFactory queryFactory;
    private final QItem qItem = QItem.item;

    public ItemRepository(EntityManager em) {
        this.queryFactory = new JPAQueryFactory(em);
    }

    public Page<Item> findItemsByCondition(String itemDetail, int price, String itemSellStat, Pageable pageable) {
        BooleanExpression booleanExpression = qItem.itemDetail.like("%" + itemDetail + "%")
                .and(qItem.price.gt(price));

        if ("SELL".equals(itemSellStat)) {
            booleanExpression = booleanExpression.and(qItem.itemSellStatus.eq(ItemSellStatus.SELL));
        }

        return queryFactory
                .selectFrom(qItem)
                .where(booleanExpression)
                .orderBy(qItem.price.desc())
                .offset(pageable.getOffset())
                .limit(pageable.getPageSize())
                .fetchResults();
    }
}
```

- ì—”í‹°í‹°ë¼ë¦¬ ì–‘ë°©í–¥ ê´€ê³„ì„±ì„ ë„ë©´, í…ŒìŠ¤íŠ¸í•  ë•Œë„ ì–‘ë°©í–¥ìœ¼ë¡œ ë„£ì–´ì¤˜ì•¼í•¨.

```java
@Test
    @DisplayName("ì˜ì†ì„± ì „ì´ í…ŒìŠ¤íŠ¸")
    public void orderTest(){

        Order order = new Order();

        for(int i=0;i<3;i++){
            Item item = this.createItem();
            itemRepository.save(item);

            OrderItem orderItem = new OrderItem();
            orderItem.setItem(item);
            orderItem.setCount(10);
            orderItem.setOrderPrice(1000);
            orderItem.setOrder(order);

						//ì´ ë¶€ë¶„ ë§í•˜ëŠ”ê±°
            order.getOrderItems().add(orderItem);

        }

        orderRepository.saveAndFlush(order);
        em.clear();

        Order savedOrder = orderRepository.findById(order.getId())
                .orElseThrow(EntityNotFoundException::new);
        assertEquals(3, savedOrder.getOrderItems().size());

    }
```

1. ì¦‰ì‹œ ë¡œë”©ê³¼ ì§€ì—° ë¡œë”©

**ì¦‰ì‹œ ë¡œë”© (Eager Loading):**

- ì¦‰ì‹œ ë¡œë”©ì€ ê´€ê³„ì— ìˆëŠ” ëª¨ë“  ì—”í‹°í‹°ë¥¼ í•œ ë²ˆì— ë¶ˆëŸ¬ì˜µë‹ˆë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´, ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ì—°ê´€ëœ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì¡°íšŒí•©ë‹ˆë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ê°€ ì‹¤í–‰ë  ë•Œ ê´€ë ¨ëœ ëª¨ë“  ë°ì´í„°ë¥¼ í•œ ë²ˆì— ë¡œë“œí•˜ê¸° ë•Œë¬¸ì— ì„±ëŠ¥ ì €í•˜ì˜ ìš”ì¸ì´ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì§€ì—° ë¡œë”© (Lazy Loading):**

- ì§€ì—° ë¡œë”©ì€ ì—°ê´€ëœ ì—”í‹°í‹°ë¥¼ ì‹¤ì œë¡œ ì‚¬ìš©í•  ë•Œ ë¡œë”©í•©ë‹ˆë‹¤.
- ì˜ˆë¥¼ ë“¤ì–´, ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ì—°ê´€ëœ ìì‹ ì—”í‹°í‹°ëŠ” ì²˜ìŒì— ì¡°íšŒë˜ì§€ ì•Šê³ , í•´ë‹¹ ìì‹ ì—”í‹°í‹°ì— ì ‘ê·¼í•  ë•Œ ì‹¤ì œë¡œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¡œë“œë©ë‹ˆë‹¤.
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ì˜ ì„±ëŠ¥ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©´ **`LazyInitializationException`**ê³¼ ê°™ì€ ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **`@OneToMany`**, **`@ManyToMany`** ê´€ê³„ì—ì„œ ê¸°ë³¸ ë¡œë”© ì „ëµì…ë‹ˆë‹¤.

**`LazyInitializationException`**

- ì§€ì—° ë¡œë”©(Lazy Loading) ì‹œ ê´€ë ¨ ì—”í‹°í‹°ê°€ ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ëŠ”ë° ì‚¬ìš©í•˜ë ¤ê³  í•  ë•Œ ë°œìƒ
- ë°œìƒ ìƒí™©
    1. ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì¡°íšŒí•  ë•Œ ìì‹ ì—”í‹°í‹°ëŠ” ì§€ì—° ë¡œë”©ìœ¼ë¡œ ì„¤ì •ë˜ì–´ ìˆì–´ ì´ˆê¸°ì— ë¡œë“œë˜ì§€ ì•ŠìŒ.
    2. íŠ¸ëœì­ì…˜ì´ ì¢…ë£Œëœ ì´í›„ì— ìì‹ ì—”í‹°í‹°ì— ì ‘ê·¼í•˜ë ¤ëŠ” ì‹œë„.

1. Auditing
- Spring Data Jpaì—ì„œëŠ” Auditing ê¸°ëŠ¥ ì œê³µ
- Audit: ê°ì‹œí•˜ë‹¤

```java
package com.shop.config;

import org.springframework.data.domain.AuditorAware;
import org.springframework.security.core.Authentication;
import org.springframework.security.core.context.SecurityContextHolder;

import java.util.Optional;

public class AuditorAwareImpl implements AuditorAware<String> {

    @Override
    public Optional<String> getCurrentAuditor() {

				//í˜„ì¬ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ê°€ì ¸ì˜´
        Authentication authentication =
                SecurityContextHolder.getContext().getAuthentication();

						//ì‚¬ìš©ì ì•„ì´ë””ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ë¹ˆ ë¬¸ìì—´ ì„ ì–¸
            String userId= "";

						//ì¸ì¦ ì •ë³´ê°€ nullì´ ì•„ë‹ˆë©´, ì‚¬ìš©ì ì•„ì´ë””ë¥¼ ê°€ì ¸ì™€ userIdì— í• ë‹¹
            if(authentication != null) {
                userId = authentication.getName();
            }
                return Optional.of(userId);
    }
}
```

- AuditorAwareImpl: JPA auditingì„ ìœ„í•´ ì‚¬ìš©ì ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” í´ë˜ìŠ¤
- **`getCurrentAuditor()` :** í˜„ì¬ ì‚¬ìš©ìë¥¼ ë‚˜íƒ€ë‚´ëŠ” **`String`**ì„ **`Optional`**ë¡œ ê°ì‹¸ì„œ ë°˜í•˜ëŠ” ë©”ì„œë“œ
- **`Authentication authentication = SecurityContextHolder.getContext().getAuthentication();`**: í˜„ì¬ ë³´ì•ˆ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©ìì˜ ì¸ì¦ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.domain.AuditorAware;
import org.springframework.data.jpa.repository.config.EnableJpaAuditing;

@Configuration
@EnableJpaAuditing
public class AuditConfig {

    @Bean
		//JPA Auditingì—ì„œ ì‚¬ìš©í•  AuditorAware êµ¬í˜„ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ë©”ì„œë“œ
    public AuditorAware<String> auditorProvider(){
        return new AuditorAwareImpl();
    }
}
```

- **`@EnableJpaAuditing`**: JPA Auditing í™œì„±í™”

```java
package com.shop.entity;

import com.shop.repository.MemberRepository;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.security.test.context.support.WithMockUser;
import org.springframework.test.context.TestPropertySource;
import org.springframework.transaction.annotation.Transactional;

import javax.persistence.EntityManager;
import javax.persistence.EntityNotFoundException;
import javax.persistence.PersistenceContext;

@SpringBootTest
@Transactional
@TestPropertySource(locations = "classpath:application-test.properties")
class MemberTest {

    @Autowired
    MemberRepository memberRepository;

    @PersistenceContext
    EntityManager em;

    @Test
    @DisplayName("Auditing í…ŒìŠ¤íŠ¸")
    @WithMockUser(username = "gildong", roles ="USER")
    public void auditingTest(){
        Member newMember = new Member();
        memberRepository.save(newMember);

        em.flush();
        em.clear();

        Member member = memberRepository.findById(newMember.getId())
                .orElseThrow(EntityNotFoundException::new);

        System.out.println("register time : " + member.getCreatedAt() );
        System.out.println("update time : " + member.getUpdatedAt() );
        System.out.println("create member : " + member.getCreatedBy() );
        System.out.println("modify member : " + member.getModifiedBy() );
    }
}
```

- **`@WithMockUser(username = "gildong", roles ="USER")`**
: Spring Security í…ŒìŠ¤íŠ¸ ì§€ì›ì„ ì‚¬ìš©í•˜ì—¬ í˜„ì¬ ì¸ì¦ëœ ì‚¬ìš©ìë¥¼ ëª¨ì˜(mock)ë¡œ ìƒì„±í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì…ë‹ˆë‹¤. "gildong"ì´ë¼ëŠ” ì‚¬ìš©ì ì´ë¦„ê³¼ "USER" ì—­í• ì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.

1. ModelMapper
- Java ì–¸ì–´ë¡œ ì‘ì„±ëœ ê°ì²´ ê°„ ë§¤í•‘ì„ ìˆ˜í–‰í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¤‘ í•˜ë‚˜
- ì£¼ë¡œ ì—”í„°í‹°(Entity) ê°ì²´ì™€ ë°ì´í„° ì „ì†¡ ê°ì²´(DTO) ì‚¬ì´ì˜ ë³€í™˜ ì‘ì—…ì— ì‚¬ìš©
- ì´ëŸ¬í•œ ë§¤í•‘ ì‘ì—…ì€ ê°ì²´ ê°„ì˜ í•„ë“œ ë³µì‚¬/ë³€í™˜í•˜ì—¬ ë¹„ìŠ·í•œ êµ¬ì¡°ì˜ ê°ì²´ë¥¼ ë‹¤ë¥¸ ê°ì²´ë¡œ ë³€í™˜í•˜ëŠ” ë°ì— í™œìš©

```java
package com.shop.dto;

import com.shop.entity.ItemImg;
import lombok.Getter;
import lombok.Setter;
import org.modelmapper.ModelMapper;

@Getter @Setter
public class ItemImgDto {
    private Long id;
    private String imgName;
    private String oriImgName;
    private String imgUrl;

    private String repImgYn;

    private static ModelMapper modelMapper = new ModelMapper();

    public static ItemImgDto of(ItemImg itemImg){
        return modelMapper.map(itemImg,ItemImgDto.class);
    }
}
```

- **`of`** ë©”ì„œë“œ:  **`ItemImg`** ì—”í„°í‹°ë¥¼ **`ItemImgDto`**ë¡œ ë§¤í•‘í•˜ëŠ” ì •ì  ë©”ì„œë“œ
- **`modelMapper.map`** ë©”ì„œë“œ: ì£¼ì–´ì§„ **`itemImg`** ê°ì²´ë¥¼ **`ItemImgDto.class`**ì— ë§¤í•‘í•˜ê³  ê²°ê³¼ë¡œ ë§¤í•‘ëœ **`ItemImgDto`** ê°ì²´ë¥¼ ë°˜í™˜

```java
package com.shop.dto;

import com.shop.consonant.ItemSellStatus;
import com.shop.entity.Item;

import lombok.Getter;
import lombok.Setter;
import org.modelmapper.ModelMapper;

import javax.validation.constraints.NotBlank;
import java.util.ArrayList;
import java.util.List;

@Getter @Setter
public class ItemFormDto {

    private Long id;

    @NotBlank(message = "ìƒí’ˆëª…ì€ í•„ìˆ˜ ì…ë ¥ ê°’ì…ë‹ˆë‹¤.")
    private String itemNm;

    @NotBlank(message = "ê°€ê²©ì€ í•„ìˆ˜ ì…ë ¥ ê°’ì…ë‹ˆë‹¤.")
    private Integer price;

    @NotBlank(message = "ì´ë¦„ì€ í•„ìˆ˜ ì…ë ¥ ê°’ì…ë‹ˆë‹¤.")
    private String itemDetail;

   private ItemSellStatus itemSellStatus;

   private List<ItemImgDto> itemImgDtoList = new ArrayList<>();

   private List<Long> itemImgIds = new ArrayList<>();

   private static ModelMapper modelMapper = new ModelMapper();

//ItemFormDto -> Itemìœ¼ë¡œ ë³€í™˜
   public Item createItem(){
       return modelMapper.map(this, Item.class);
   }

//Item -> ItemFormDtoë¡œ ë³€í™˜
   public static ItemFormDto of(Item item){
       return modelMapper.map(item,ItemFormDto.class);
   }
}
```